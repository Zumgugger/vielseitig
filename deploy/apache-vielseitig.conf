<VirtualHost *:80>
    ServerName vielseitig.zumgugger.ch
    
    # Redirect HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName vielseitig.zumgugger.ch
    
    # SSL Configuration (Let's Encrypt)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/vielseitig.zumgugger.ch/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/vielseitig.zumgugger.ch/privkey.pem
    
    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket support (if needed)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) ws://127.0.0.1:8000/$1 [P,L]
    
    # Proxy all requests to the Docker container
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # Headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "vielseitig.zumgugger.ch"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/vielseitig-error.log
    CustomLog ${APACHE_LOG_DIR}/vielseitig-access.log combined
</VirtualHost>
